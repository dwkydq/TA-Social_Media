{% extends 'base.html' %}

{% block content %}

<div class="relative pb-20"> <div class="h-48 bg-zinc-800 w-full overflow-hidden relative">
        {% if user.cover_pic %}
            <img src="{{ url_for('static', filename='uploads/' + user.cover_pic) }}" class="w-full h-full object-cover">
        {% else %}
            <div class="w-full h-full flex items-center justify-center text-gray-600 bg-zinc-900">
                <i class="fas fa-image text-4xl opacity-20"></i>
            </div>
        {% endif %}
    </div>

    <div class="px-6">
        <div class="flex justify-between items-end -mt-12 mb-4">
            <img src="{{ url_for('static', filename='uploads/' + user.profile_pic) if user.profile_pic else 'https://ui-avatars.com/api/?name=' + user.name }}" 
                 class="w-32 h-32 rounded-full border-4 border-black bg-zinc-900 object-cover relative z-10">
            
            {% if current_user.id == user.id %}
                <a href="{{ url_for('user.edit_profile') }}" class="btn-xyz py-2 px-4 text-sm w-auto rounded-full">Edit Profil</a>
            {% else %}
                {% if current_user.is_following(user) %}
                    <a href="{{ url_for('user.unfollow', username=user.username) }}" class="border-2 border-red-500 text-red-500 font-bold py-2 px-6 rounded-full hover:bg-red-500 hover:text-white transition">Unfollow</a>
                {% else %}
                    <a href="{{ url_for('user.follow', username=user.username) }}" class="btn-xyz py-2 px-6 rounded-full w-auto">Follow</a>
                {% endif %}
            {% endif %}
        </div>

        <h1 class="text-2xl font-black text-white leading-none">{{ user.name }}</h1>
        <p class="text-gray-500 mb-4">@{{ user.username }}</p>

        {% if user.bio %}
            <p class="text-white mb-4">{{ user.bio }}</p>
        {% endif %}

        <div class="flex gap-4 text-sm text-gray-400 mb-6">
            <span><i class="far fa-calendar-alt"></i> Bergabung {{ user.created_at.strftime('%B %Y') }}</span>
            <div class="flex gap-3">
                <span><strong class="text-white">{{ user.following.count() }}</strong> Mengikuti</span>
                <span><strong class="text-white">{{ user.followers.count() }}</strong> Pengikut</span>
            </div>
        </div>
        
        <div class="flex border-b border-gray-800 mb-6">
            <a href="{{ url_for('user.profile', username=user.username, tab='posts') }}" 
               class="px-6 py-3 font-bold transition {{ 'text-xyz-yellow border-b-2 border-xyz-yellow' if active_tab == 'posts' else 'text-gray-500 hover:text-white' }}">
               Postingan
            </a>
            
            <a href="{{ url_for('user.profile', username=user.username, tab='media') }}" 
               class="px-6 py-3 font-bold transition {{ 'text-xyz-yellow border-b-2 border-xyz-yellow' if active_tab == 'media' else 'text-gray-500 hover:text-white' }}">
               Media
            </a>
            
            <a href="{{ url_for('user.profile', username=user.username, tab='likes') }}" 
               class="px-6 py-3 font-bold transition {{ 'text-xyz-yellow border-b-2 border-xyz-yellow' if active_tab == 'likes' else 'text-gray-500 hover:text-white' }}">
               Suka
            </a>
        </div>

        <div class="space-y-6">
            {% for post in posts %}
            <div class="bg-zinc-900 border border-gray-800 p-4 rounded-xl hover:bg-zinc-800/50 transition">
                
                <div class="flex gap-3">
                    <img src="{{ url_for('static', filename='uploads/' + post.author.profile_pic) if post.author.profile_pic else 'https://ui-avatars.com/api/?name=' + post.author.name }}" 
                         class="w-10 h-10 rounded-full border border-gray-600 object-cover shrink-0">
                    
                    <div class="flex-1 min-w-0"> <div class="flex justify-between items-start">
                            <div>
                                <a href="{{ url_for('user.profile', username=post.author.username) }}" class="font-bold text-white hover:underline">{{ post.author.name }}</a>
                                <span class="text-gray-500 text-sm ml-1">@{{ post.author.username }} Â· {{ post.created_at.strftime('%d %b') }}</span>
                            </div>
                            
                            {% if current_user.id == post.author.id and active_tab != 'likes' %}
                                <a href="{{ url_for('post.delete_post', post_id=post.id) }}" onclick="return confirm('Hapus?')" class="text-gray-600 hover:text-red-500">
                                    <i class="fas fa-trash"></i>
                                </a>
                            {% endif %}
                        </div>

                        <p class="text-white mt-1 mb-3 whitespace-pre-line">{{ post.caption }}</p>

                        {% if post.media_url %}
                            <div class="mb-3">
                                {% if post.media_type == 'video' %}
                                    <video controls class="w-full rounded-lg border border-gray-700 bg-black max-h-[400px]">
                                        <source src="{{ url_for('static', filename='uploads/' + post.media_url) }}" type="video/mp4">
                                    </video>
                                {% else %}
                                    <img src="{{ url_for('static', filename='uploads/' + post.media_url) }}" class="w-full rounded-lg border border-gray-700 max-h-[400px] object-cover">
                                {% endif %}
                            </div>
                        {% endif %}

                        <div class="flex items-center gap-6 text-gray-500 text-sm">
                            <a href="{{ url_for('post.like_post', post_id=post.id) }}" class="flex items-center gap-2 group transition {{ 'text-red-500' if post.is_liked_by(current_user) else '' }}">
                                <i class="{{ 'fas' if post.is_liked_by(current_user) else 'far' }} fa-heart group-hover:text-red-500"></i>
                                <span>{{ post.likes|length }}</span>
                            </a>
                            
                            <a href="{{ url_for('post.post_detail', post_id=post.id) }}" class="flex items-center gap-2 group hover:text-blue-400">
                                <i class="far fa-comment"></i>
                                <span>{{ post.comments|length }}</span>
                            </a>
                        </div>
                    </div>
                </div>

            </div>
            {% else %}
                <div class="text-center text-gray-500 py-10">
                    {% if active_tab == 'likes' %}
                        <p class="text-lg">Belum ada yang disukai.</p>
                        <small>Klik ikon hati pada postingan yang kamu suka!</small>
                    {% elif active_tab == 'media' %}
                        <p class="text-lg">Belum ada foto atau video.</p>
                    {% else %}
                        <p class="text-lg">Pengguna ini belum memposting apapun.</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

    </div>
</div>
{% endblock %}